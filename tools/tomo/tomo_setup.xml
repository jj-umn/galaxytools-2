<tool id="tomo_setup" name="Tomo Setup" version="0.1.2" python_template_version="3.9">
    <description>Preprocess tomography images</description>
    <macros>
        <import>tomo_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir setup_pngs;
        cp '$inputfiles' inputfiles.txt &&
        $__tool_directory__/tomo_setup.py
        -i inputfiles.txt
        -c '$config'
        --theta_range '$thetas.theta_start $thetas.theta_end $thetas.num_thetas'
        --output_data 'output_data.npz'
        --output_config 'output_config.yaml'
        -l '$log'
#for $s in $tomo_sets# ${s.offset} ${s.num} #end for
    ]]></command>
    <configfiles>
         <configfile name="inputfiles"><![CDATA[#slurp
#for $s in $tomo_sets
#for $input in $s.inputs
#echo str($input) + '\t' + $input.element_identifier #
#end for
#end for
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="common_inputs"/>
        <section name="thetas" title="Tomography angles">
            <param name="theta_start" type="float" min="0.0" max="360.0" value="0.0" label="Lower bound"/>
            <param name="theta_end" type="float" min="0.0" max="360.0" value="0.0" label="Upper bound"/>
            <param name="num_thetas" type="integer" min="1" value="1" label="Number of angles"/>
        </section>
        <repeat name='tomo_sets' title="Tomography image sets">
            <param name="inputs" type="data_collection" label="Image file collection"/>
            <param name="offset" type="integer" min="0" value="0" label="Image index offset"/>
            <param name="num" type="integer" min="1" value="1" label="Number of images"/>
        </repeat>
    </inputs>
    <outputs>
        <expand macro="common_outputs"/>
        <data name="inputfiles" format="txt" label="Input files" from_work_dir="inputfiles.txt" hidden="true"/>
        <collection name="setup_pngs" type="list" label="Tomo setup images">
            <discover_datasets pattern="__name_and_ext__" directory="setup_pngs"/>
        </collection>
        <data name="output_config" format="yaml" label="Output config setup" from_work_dir="output_config.yaml"/>
        <data name="output_data" format="npz" label="Preprocessed tomography data" from_work_dir="output_data.npz"/>
    </outputs>
    <help><![CDATA[
        Preprocess tomography images.
    ]]></help>
    <expand macro="citations"/>
</tool>
